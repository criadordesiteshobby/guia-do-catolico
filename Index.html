<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portal do Cat√≥lico</title>
  <style>
    :root{
      --gold:#ffcc00;
      --gray:#2e2e2e;
      --light-gray:#f0f0f0;
      --bg:#fffdf5;
      --muted:#666;
      --card:#ffffff;
      --radius:12px;
      --nav-width:300px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Poppins,system-ui,Arial; background:var(--bg); color:#222;
    }

    /* Top bar */
    .topbar{
      height:64px;
      display:flex;
      align-items:center;
      gap:12px;
      padding:0 16px;
      background:linear-gradient(90deg,#ffffff, #fff7d6);
      box-shadow:0 4px 10px rgba(0,0,0,.06);
      position:fixed;
      left:0; right:0; top:0; z-index:30;
    }
    .menu-btn{
      background:var(--gray);
      color:white;
      border:none;
      padding:8px 12px;
      border-radius:8px;
      font-size:1.1rem;
      cursor:pointer;
    }
    .site-title{ font-weight:800; color:var(--gray); font-size:1.2rem; }

    /* Sidebar */
    .sidebar{
      position:fixed;
      left:0; top:64px;
      width:var(--nav-width);
      bottom:0;
      background:var(--light-gray);
      border-right:1px solid rgba(0,0,0,.06);
      padding:18px 12px;
      transform:translateX(-340px);
      transition:transform .28s ease;
      z-index:40;
    }
    .sidebar.open{ transform:translateX(0); }
    .sidebar h2{ margin:0 0 14px; text-align:center; color:var(--gold); }
    .nav-list{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px; }
    .nav-list button{
      background:white; border:none; padding:12px 10px; text-align:left; border-radius:10px;
      font-weight:700; cursor:pointer; box-shadow:0 4px 14px rgba(0,0,0,.04);
    }
    .nav-list button:hover{ transform:translateY(-2px); }

    /* Main content */
    main{ margin-top:64px; padding:20px; margin-left:0; transition:margin-left .28s ease; min-height:calc(100vh - 64px); }
    main.shift{ margin-left:var(--nav-width); }

    .card{ background:var(--card); border-radius:var(--radius); padding:16px; box-shadow:0 6px 20px rgba(0,0,0,.04); margin-bottom:16px; }

    /* Chat */
    .chat-wrap{ display:flex; flex-direction:column; gap:12px; height:70vh; }
    .messages{ flex:1; overflow:auto; border:1px solid rgba(0,0,0,.06); border-radius:12px; padding:12px; background:#fff; }
    .message{
      background:#fbfbfb; margin-bottom:10px; border-radius:10px; padding:8px 10px; position:relative;
      display:flex; gap:8px; align-items:flex-start;
    }
    .message .meta{ font-size:.85rem; color:var(--muted); margin-bottom:6px; }
    .message .text{ white-space:pre-wrap; }
    .message .reactions{ margin-top:6px; display:flex; gap:6px; flex-wrap:wrap; }

    .message .msg-actions{
      position:absolute; right:8px; top:8px; display:none; gap:6px;
    }
    .message:hover .msg-actions{ display:flex; }

    .input-area{ display:flex; gap:8px; margin-top:8px; }
    .input-area input{ flex:1; padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,.06); }
    .input-area button{ background:var(--gold); border:none; color:#222; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:800; }

    /* Config */
    .config-row{ display:flex; gap:12px; align-items:center; margin-top:10px; }
    .status-btn{ padding:10px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
    .btn-online{ background:#2ecc71; color:white; }
    .btn-offline{ background:#95a5a6; color:white; }

    /* small */
    .small{ font-size:.9rem; color:var(--muted); }

    /* responsive */
    @media(max-width:920px){
      :root{ --nav-width:260px; }
      .sidebar{ width:var(--nav-width); }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <button class="menu-btn" id="toggleMenu">‚ò∞ Menu</button>
    <div class="site-title">Portal do Cat√≥lico</div>
    <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
      <div id="userBadge" class="small">N√£o logado</div>
      <button id="openLogin" class="menu-btn" style="background:var(--gold);color:#222">Login</button>
    </div>
  </div>

  <aside class="sidebar" id="sidebar">
    <h2>Portal do Cat√≥lico</h2>
    <ul class="nav-list">
      <li><button data-target="mainHome">üè† Menu Principal</button></li>
      <li><button data-target="chatPage">üí¨ Chat Online</button></li>
      <li><button data-target="historyPage">üìú Hist√≥ria</button></li>
      <li><button data-target="configPage">‚öôÔ∏è Configura√ß√µes</button></li>
      <li><button data-target="accountPage">üë§ Conta</button></li>
    </ul>
    <div style="margin-top:18px;font-size:.9rem;color:var(--muted);text-align:center">
      Feito com f√© üáªüá¶
    </div>
  </aside>

  <main id="main" aria-live="polite">
    <!-- Menu Principal -->
    <section id="mainHome" class="card active">
      <h2>Bem-vindo ao Portal do Cat√≥lico</h2>
      <p class="small">Aqui voc√™ encontra ora√ß√µes, hist√≥ria, not√≠cias e um chat para comunh√£o fraterna.</p>

      <div id="homeContent" style="margin-top:12px;">
        <p><strong>Passos de f√© (exemplo):</strong></p>
        <ol>
          <li>Ame a Deus sobre todas as coisas.</li>
          <li>Siga o exemplo de Jesus.</li>
          <li>Ore todos os dias.</li>
          <li>Leia e medite a Palavra de Deus.</li>
          <li>Participe da Santa Missa.</li>
        </ol>
      </div>
    </section>

    <!-- Chat -->
    <section id="chatPage" class="card" style="display:none">
      <h2>Chat Online</h2>
      <div class="chat-wrap">
        <div class="messages" id="messages"></div>

        <div class="input-area">
          <input id="msgInput" placeholder="Digite sua mensagem..." />
          <button id="sendBtn">Enviar</button>
        </div>
      </div>
      <p class="small" style="margin-top:8px">Dica: pressione uma mensagem para a√ß√µes (copiar, reagir, responder, ver hor√°rio).</p>
    </section>

    <!-- Hist√≥ria -->
    <section id="historyPage" class="card" style="display:none">
      <h2>Hist√≥ria da Igreja Cat√≥lica Apost√≥lica Romana</h2>
      <div style="max-height:60vh; overflow:auto; padding-right:8px;">
        <p><strong>Resumo hist√≥rico (vers√£o completa):</strong></p>
        <p>
          A Igreja Cat√≥lica Apost√≥lica Romana tem suas ra√≠zes diretamente nos ap√≥stolos, com Pedro frequentemente
          reconhecido como o primeiro Bispo de Roma. Ao longo de quase dois mil anos, a Igreja desenvolveu uma rica
          tradi√ß√£o teol√≥gica, lit√∫rgica e pastoral. Ela foi central na tradu√ß√£o e preserva√ß√£o de textos sagrados,
          no desenvolvimento das artes e das universidades e na organiza√ß√£o da assist√™ncia social e caritativa.
        </p>
        <p>
          Do Imp√©rio Romano √† Idade M√©dia, das Cruzadas ao Conc√≠lio de Trento, das reformas do s√©culo XX ao
          Conc√≠lio Vaticano II, a Igreja experimentou transforma√ß√µes profundas e procurou responder aos desafios
          de cada √©poca mantendo a fidelidade √† mensagem de Cristo. O Papa, como sucessor de Pedro, orienta o
          Magist√©rio da Igreja. A tradi√ß√£o sacramental, a devo√ß√£o mariana e a comunh√£o dos santos s√£o tra√ßos
          distintivos do catolicismo.
        </p>
        <p>
          (Se quiser, posso inserir um texto mais detalhado e cronol√≥gico com datas, papas importantes,
          eventos e refer√™ncias ‚Äî me diga que eu completo.)
        </p>
      </div>
    </section>

    <!-- Configura√ß√µes -->
    <section id="configPage" class="card" style="display:none">
      <h2>Configura√ß√µes</h2>
      <div class="card">
        <div class="small">Digite a senha para acessar as configura√ß√µes:</div>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <input id="confPass" type="password" placeholder="Senha" />
          <button id="enterConf" class="status-btn" style="background:var(--gold);color:#222">Entrar</button>
        </div>

        <div id="confArea" style="display:none; margin-top:12px;">
          <div class="config-row">
            <button id="goOnline" class="status-btn btn-online">Estamos Online</button>
            <button id="goOffline" class="status-btn btn-offline">N√£o Estamos Online</button>
            <div id="confStatus" style="margin-left:12px;font-weight:800;color:var(--muted)"></div>
          </div>
          <div style="margin-top:12px;">
            <div class="small">Usu√°rios online neste site: <span id="onlineCount">0</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Conta -->
    <section id="accountPage" class="card" style="display:none">
      <h2>Conta</h2>
      <div id="accountContent">
        <p id="acctInfo" class="small">Sem usu√°rio logado.</p>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button id="logoutBtn" style="background:#ff6b6b;color:white;border:none;padding:8px 10px;border-radius:8px;cursor:pointer;">Sair</button>
        </div>
      </div>
    </section>

  </main>

  <!-- Modal login simples -->
  <div id="loginModal" style="display:none; position:fixed; left:0; top:0; right:0; bottom:0; background:rgba(0,0,0,.4); align-items:center; justify-content:center; z-index:80;">
    <div style="background:white; padding:20px; border-radius:12px; width:340px;">
      <h3 style="margin:0 0 8px">Login / Cadastro</h3>
      <input id="emailInput" placeholder="Email" style="width:100%;padding:8px;margin-bottom:8px;border-radius:8px;border:1px solid #ddd;" />
      <input id="pwdInput" type="password" placeholder="Senha" style="width:100%;padding:8px;margin-bottom:8px;border-radius:8px;border:1px solid #ddd;" />
      <div style="display:flex; gap:8px;">
        <button id="doLogin" style="flex:1;background:var(--gold);border:none;padding:10px;border-radius:8px;font-weight:800;cursor:pointer;">Entrar</button>
        <button id="doRegister" style="flex:1;background:#ddd;border:none;padding:10px;border-radius:8px;cursor:pointer;">Cadastrar</button>
      </div>
      <div style="margin-top:8px;text-align:right">
        <button id="closeLogin" style="background:transparent;border:none;color:var(--muted);cursor:pointer">Fechar</button>
      </div>
      <p id="loginMsg" class="small" style="color:crimson"></p>
    </div>
  </div>

  <script type="module">
    /* =============================
       INSTRU√á√ïES FIREBASE (opcional)
       =============================
       - Se voc√™ quiser usar o Firebase "REAL" (Auth + Firestore), cole suas chaves abaixo e
         descomente a inicializa√ß√£o das libs Firebase (linhas indicadas).
       - Se N√ÉO colar, o site usa um modo SIMULADO (localStorage) para testar tudo na hora.
    */

    // -------------------------
    // COLE AQUI SUAS CHAVES FIREBASE
    // -------------------------
    const firebaseConfig = {
      // Exemplo:
      // apiKey: "AIzaSy....",
      // authDomain: "seu-projeto.firebaseapp.com",
      // projectId: "seu-projeto",
      // storageBucket: "seu-projeto.appspot.com",
      // messagingSenderId: "1234567890",
      // appId: "1:123456:web:abcdef",
    };

    // DETECTA se o usu√°rio colou config (checa apiKey como exemplo)
    const hasFirebaseConfig = !!(firebaseConfig && firebaseConfig.apiKey);

    // Se o dev colar as chaves, as imports abaixo ser√£o usadas.
    // OBS: As linhas de import est√£o comentadas para evitar erros se n√£o houver config.
    let firebase = null;
    let auth = null;
    let db = null;
    if (hasFirebaseConfig) {
      // Se quiser ativar Firebase real, remova os coment√°rios e certifique-se de colar as chaves above.
      // import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
      // import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
      // import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, doc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
      //
      // const app = initializeApp(firebaseConfig);
      // auth = getAuth(app);
      // db = getFirestore(app);
      //
      // // (Opcional) setPersistence(auth, browserLocalPersistence);
      //
      // firebase = { app, auth, db };
    }

    /* =============================
       FUN√á√ïES DE NAVEGA√á√ÉO / MENU
       ============================= */
    const sidebar = document.getElementById('sidebar');
    const main = document.getElementById('main');
    const toggleBtn = document.getElementById('toggleMenu');
    const navButtons = document.querySelectorAll('.nav-list button');

    function openSidebar(open=true){
      if(open){
        sidebar.classList.add('open');
        main.classList.add('shift');
      } else {
        sidebar.classList.remove('open');
        main.classList.remove('shift');
      }
    }

    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      main.classList.toggle('shift');
    });

    navButtons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        const target = e.currentTarget.dataset.target;
        showSection(target);
        // fecha sidebar em telas pequenas
        if(window.innerWidth < 920) openSidebar(false);
      });
    });

    function showSection(id){
      document.querySelectorAll('main section').forEach(s => s.style.display = 'none');
      const el = document.getElementById(id);
      if(el) el.style.display = 'block';
      // foco simples
      window.scrollTo({top:0, behavior:'smooth'});
    }

    // Inicial: mostrar p√°gina principal
    showSection('mainHome');

    /* =============================
       LOGIN / CONTA (simulado ou firebase)
       - Se hasFirebaseConfig true e libs ativadas, substitua
         pelas chamadas reais do Firebase Auth.
       ============================= */
    let currentUser = null;

    const loginModal = document.getElementById('loginModal');
    const openLogin = document.getElementById('openLogin');
    const closeLogin = document.getElementById('closeLogin');
    const doLogin = document.getElementById('doLogin');
    const doRegister = document.getElementById('doRegister');
    const emailInput = document.getElementById('emailInput');
    const pwdInput = document.getElementById('pwdInput');
    const loginMsg = document.getElementById('loginMsg');
    const userBadge = document.getElementById('userBadge');
    const acctInfo = document.getElementById('acctInfo');
    const logoutBtn = document.getElementById('logoutBtn');

    openLogin.addEventListener('click', () => {
      loginModal.style.display = 'flex';
      loginMsg.textContent = '';
    });
    closeLogin.addEventListener('click', () => loginModal.style.display = 'none');

    // UTIL: salva usu√°rio simulado no localStorage
    function saveSimUser(email, pwd){
      const users = JSON.parse(localStorage.getItem('sim_users') || '{}');
      users[email] = { email, pwd };
      localStorage.setItem('sim_users', JSON.stringify(users));
    }
    function checkSimUser(email, pwd){
      const users = JSON.parse(localStorage.getItem('sim_users') || '{}');
      return users[email] && users[email].pwd === pwd;
    }

    doRegister.addEventListener('click', () => {
      const email = emailInput.value.trim();
      const pwd = pwdInput.value;
      if(!email || !pwd){ loginMsg.textContent = 'Preencha email e senha.'; return; }
      // No modo real, aqui chamaria createUserWithEmailAndPassword
      if(hasFirebaseConfig){ loginMsg.textContent = 'Ative Firebase no c√≥digo para registrar.'; return; }
      saveSimUser(email, pwd);
      currentUser = { email };
      loginModal.style.display = 'none';
      updateUIOnLogin();
    });

    doLogin.addEventListener('click', () => {
      const email = emailInput.value.trim();
      const pwd = pwdInput.value;
      if(!email || !pwd){ loginMsg.textContent = 'Preencha email e senha.'; return; }
      if(hasFirebaseConfig){ loginMsg.textContent = 'Ative Firebase no c√≥digo para logar real.'; return; }
      if(checkSimUser(email, pwd)){
        currentUser = { email };
        loginModal.style.display = 'none';
        updateUIOnLogin();
      } else {
        loginMsg.textContent = 'Usu√°rio n√£o encontrado ou senha incorreta.';
      }
    });

    logoutBtn.addEventListener('click', () => {
      // real: signOut(auth)
      currentUser = null;
      updateUIOnLogin();
      alert('Voc√™ saiu.');
    });

    function updateUIOnLogin(){
      if(currentUser){
        userBadge.textContent = currentUser.email;
        acctInfo.textContent = `Logado como: ${currentUser.email}`;
        openLogin.style.display = 'none';
      } else {
        userBadge.textContent = 'N√£o logado';
        acctInfo.textContent = 'Sem usu√°rio logado.';
        openLogin.style.display = 'inline-block';
      }
    }
    updateUIOnLogin();

    /* =============================
       CHAT (modo real com Firestore se ativado; fallback localStorage)
       ============================= */
    const messagesDiv = document.getElementById('messages');
    const msgInput = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');

    // Simula√ß√£o: mensagens em localStorage
    function loadSimMessages(){
      return JSON.parse(localStorage.getItem('sim_mensagens') || '[]');
    }
    function saveSimMessage(msg){
      const arr = loadSimMessages();
      arr.push(msg);
      localStorage.setItem('sim_mensagens', JSON.stringify(arr));
    }

    function renderMessages(msgs){
      messagesDiv.innerHTML = '';
      msgs.forEach((m, idx) => {
        const div = document.createElement('div');
        div.className = 'message';
        div.dataset.idx = idx;
        const timeStr = new Date(m.horario).toLocaleTimeString();
        div.innerHTML = `
          <div style="flex:1">
            <div class="meta"><strong>${escapeHtml(m.nome)}</strong></div>
            <div class="text">${escapeHtml(m.texto)}</div>
            <div class="reactions" data-reactions></div>
          </div>
          <div class="msg-actions">
            <button title="Copiar" data-action="copy">üìã</button>
            <button title="Reagir" data-action="react">‚ù§Ô∏è</button>
            <button title="Responder" data-action="reply">‚Ü©Ô∏è</button>
            <button title="Ver hor√°rio" data-action="time">üïí</button>
          </div>
        `;
        // render reactions if houver
        const reactionsEl = div.querySelector('[data-reactions]');
        if(m.reacoes){
          Object.entries(m.reacoes).forEach(([emoji, count]) => {
            const span = document.createElement('span');
            span.textContent = `${emoji} ${count}`;
            reactionsEl.appendChild(span);
          });
        }
        // attach events
        div.querySelectorAll('.msg-actions button').forEach(b => {
          b.addEventListener('click', (ev) => {
            ev.stopPropagation();
            const action = b.dataset.action;
            handleMsgAction(action, m, idx, div);
          });
        });

        // long press support (mobile) -> show small popup (we use the same actions)
        let pressTimer = null;
        div.addEventListener('touchstart', (e) => {
          pressTimer = setTimeout(()=> {
            // show actions by simulating clicking first action (or custom menu)
            // we will open a small contextual menu (use native prompt for simplicity)
            showContextMenuForMessage(m, idx, div);
          }, 600);
        });
        div.addEventListener('touchend', ()=> clearTimeout(pressTimer));
        div.addEventListener('mousedown', (e)=> {
          pressTimer = setTimeout(()=> {
            showContextMenuForMessage(m, idx, div);
          }, 700);
        });
        div.addEventListener('mouseup', ()=> clearTimeout(pressTimer));

        messagesDiv.appendChild
