<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portal do Cat√≥lico</title>
  <style>
    :root{
      --gold:#B8860B;
      --lime:#d9ff91;
      --bg:#fffdf5;
      --muted:#666;
      --card:#fff;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{font-family:Poppins,system-ui,Arial; margin:0; background:var(--bg); color:#222}
    header{background:linear-gradient(90deg,#fff,#f0c93d,#d9ff91); padding:18px; text-align:center; font-weight:700; font-size:1.6rem; box-shadow:0 4px 10px rgba(0,0,0,.06)}
    main{max-width:1000px;margin:28px auto;padding:16px}
    .grid{display:grid; grid-template-columns:360px 1fr; gap:18px}
    @media(max-width:920px){ .grid{grid-template-columns:1fr} }
    .card{background:var(--card); border-radius:var(--radius); padding:16px; box-shadow:0 6px 20px rgba(0,0,0,.04)}
    h2{color:var(--gold); margin:0 0 12px}
    input{width:100%; padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,.08); margin:8px 0}
    button{background:var(--gold); color:white; border:none; padding:10px 14px;border-radius:10px; cursor:pointer; font-weight:700}
    button.ghost{background:transparent;color:var(--gold);border:2px solid rgba(0,0,0,.06)}
    .muted{color:var(--muted)}
    .center{text-align:center}
    .flag{font-size:2.6rem}
    footer{padding:14px;text-align:center;color:var(--muted);margin-top:18px}
    .small{font-size:.9rem;color:var(--muted)}
  </style>
</head>
<body>
  <header>‚úùÔ∏è Portal do Cat√≥lico ‚úùÔ∏è</header>

  <main>
    <div class="grid">
      <!-- SIDEBAR: Login / User -->
      <div class="card" id="sidebar">
        <!-- Auth block -->
        <div id="authBlock">
          <h2>Login / Cadastro</h2>
          <input id="email" type="email" placeholder="Email" autocomplete="username" />
          <input id="password" type="password" placeholder="Senha (min 6 caracteres)" autocomplete="current-password" />
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="btnRegister">Cadastrar</button>
            <button id="btnLogin" class="ghost">Entrar</button>
          </div>
          <p id="authMsg" class="small muted"></p>
        </div>

        <!-- User block (aparece ap√≥s login) -->
        <div id="userBlock" style="display:none">
          <h2 id="welcomeTitle">Bem-vindo(a)</h2>
          <p class="small muted" id="userEmail">‚Äî</p>

          <div style="margin:12px 0">
            <div class="center flag">üáªüá¶</div>
            <p class="center">Bandeiras coletadas: <strong id="flagCount">0</strong></p>
            <p class="center small muted" id="nextMsg">Pr√≥xima coleta: dispon√≠vel</p>
            <div class="center" style="margin-top:10px">
              <button id="btnCollect">Coletar bandeira</button>
            </div>
            <div class="center" style="margin-top:10px">
              <button id="btnLogout" class="ghost" style="background:transparent;color:#c0392b;border:1px solid rgba(0,0,0,.06)">Sair</button>
            </div>
          </div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(0,0,0,.04)" />
        <p class="small muted">Dica: o sistema salva suas bandeiras na sua conta do Firebase. S√≥ voc√™ v√™ seu progresso.</p>
      </div>

      <!-- MAIN CONTENT -->
      <div>
        <section class="card">
          <h2>Portal do Cat√≥lico ‚Äî Guia e Recursos</h2>
          <p class="small muted">Se√ß√µes: Ora√ß√µes, Santos, Curiosidades e Not√≠cias. Fa√ßa login para coletar bandeiras üáªüá¶ a cada 1 hora.</p>
        </section>

        <section class="card" style="margin-top:18px">
          <h2>Ora√ß√µes</h2>
          <div style="display:grid;gap:12px">
            <div>
              <strong>Pai Nosso</strong>
              <p class="small muted">Pai nosso, que estais nos c√©us, santificado seja o vosso nome...</p>
            </div>
            <div>
              <strong>Ave Maria</strong>
              <p class="small muted">Ave Maria, cheia de gra√ßa, o Senhor √© convosco...</p>
            </div>
          </div>
        </section>

        <section class="card" style="margin-top:18px">
          <h2>Santos & Curiosidades</h2>
          <div style="display:grid;gap:12px">
            <div>
              <strong>S√£o Francisco de Assis</strong>
              <p class="small muted">Padroeiro dos animais. Exemplo de humildade.</p>
            </div>
            <div>
              <strong>Santa Rita de C√°ssia</strong>
              <p class="small muted">Conhecida como a santa das causas imposs√≠veis.</p>
            </div>
          </div>
        </section>

        <section class="card" style="margin-top:18px">
          <h2>Not√≠cias & Eventos</h2>
          <div style="display:grid;gap:12px">
            <div>
              <strong>Papa incentiva ora√ß√£o pela paz</strong>
              <p class="small muted">Mensagem recente incentiva a comunidade a rezar por reconcilia√ß√£o.</p>
            </div>
            <div>
              <strong>Campanha de caridade local</strong>
              <p class="small muted">Inscri√ß√µes abertas para voluntariado paroquial.</p>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <footer>¬© 2025 Portal do Cat√≥lico ‚Ä¢ Feito com f√© üáªüá¶</footer>

  <!-- Firebase + l√≥gica -->
  <script type="module">
    /* ------------------------------
       IMPORTS (modular SDK)
       ------------------------------ */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    /* ------------------------------------------------
       SUA CONFIG DO FIREBASE (VOC√ä J√Å MANDOU ESSA)
       ------------------------------------------------
       Vou usar exatamente a config que voc√™ enviou.
    */
    const firebaseConfig = {
      apiKey: "AIzaSyBs8B_Vsmx3pc3UnGDOiseSoeH0D4w2M0k",
      authDomain: "guia-do-catolico-fb-login.firebaseapp.com",
      projectId: "guia-do-catolico-fb-login",
      storageBucket: "guia-do-catolico-fb-login.firebasestorage.app",
      messagingSenderId: "607834445049",
      appId: "1:607834445049:web:1fc49e7107bd0a5c387e28",
      measurementId: "G-QP68MRVQ8B"
    };

    /* Inicializa Firebase */
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    /* ELEMENTOS */
    const emailEl = document.getElementById('email');
    const passwordEl = document.getElementById('password');
    const btnRegister = document.getElementById('btnRegister');
    const btnLogin = document.getElementById('btnLogin');
    const btnLogout = document.getElementById('btnLogout');
    const authMsg = document.getElementById('authMsg');

    const userBlock = document.getElementById('userBlock');
    const authBlock = document.getElementById('authBlock');
    const welcomeTitle = document.getElementById('welcomeTitle');
    const userEmailSpan = document.getElementById('userEmail');
    const flagCountEl = document.getElementById('flagCount');
    const nextMsg = document.getElementById('nextMsg');
    const btnCollect = document.getElementById('btnCollect');

    /* Estado local */
    let currentUser = null;
    let userData = { bandeiras: 0, ultimo: 0 }; // ultimo = timestamp da √∫ltima coleta (ms)

    /* Fun√ß√£o: carrega (ou cria) doc do usu√°rio no Firestore */
    async function ensureUserDoc(uid) {
      const ref = doc(db, "usuarios", uid);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        await setDoc(ref, { bandeiras: 0, ultimo: 0 });
        return { bandeiras: 0, ultimo: 0 };
      } else {
        return snap.data();
      }
    }

    /* Atualiza a UI do usu√°rio com os dados */
    function refreshUserUI() {
      flagCountEl.textContent = userData.bandeiras ?? 0;
      userEmailSpan.textContent = currentUser ? currentUser.email : '‚Äî';
      // Atualiza bot√£o de coletar com base no √∫ltimo
      const agora = Date.now();
      const diff = Math.max(0, 3600000 - (agora - (userData.ultimo || 0)));
      if (diff <= 0) {
        nextMsg.textContent = "Pr√≥xima coleta: dispon√≠vel";
        btnCollect.disabled = false;
      } else {
        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);
        nextMsg.textContent = `Pr√≥xima coleta: ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        btnCollect.disabled = true;
      }
    }

    /* Atualizador de timer a cada segundo (apenas UI) */
    setInterval(() => {
      if (currentUser) refreshUserUI();
    }, 1000);

    /* -------------------------
       AUTENTICA√á√ÉO: cadastro
       ------------------------- */
    btnRegister.addEventListener('click', async () => {
      authMsg.textContent = '';
      const email = emailEl.value.trim();
      const password = passwordEl.value;
      if (!email || !password) { authMsg.textContent = 'Preencha email e senha.'; return; }
      if (password.length < 6) { authMsg.textContent = 'Senha precisa ter ao menos 6 caracteres.'; return; }
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        authMsg.textContent = 'Conta criada ‚Äî entrando...';
      } catch (err) {
        authMsg.textContent = 'Erro: ' + (err.message || err);
        console.error(err);
      }
    });

    /* -------------------------
       AUTENTICA√á√ÉO: login
       ------------------------- */
    btnLogin.addEventListener('click', async () => {
      authMsg.textContent = '';
      const email = emailEl.value.trim();
      const password = passwordEl.value;
      if (!email || !password) { authMsg.textContent = 'Preencha email e senha.'; return; }
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (err) {
        authMsg.textContent = 'Erro: ' + (err.message || err);
        console.error(err);
      }
    });

    /* -------------------------
       LOGOUT
       ------------------------- */
    btnLogout.addEventListener('click', async () => {
      await signOut(auth);
    });

    /* -------------------------
       ON AUTH STATE CHANGED
       ------------------------- */
    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      if (user) {
        // esconder auth, mostrar user
        authBlock.style.display = 'none';
        userBlock.style.display = 'block';
        // carrega doc do user
        try {
          userData = await ensureUserDoc(user.uid);
        } catch (err) {
          console.error('Erro ao carregar doc do usu√°rio:', err);
          userData = { bandeiras: 0, ultimo: 0 };
        }
        refreshUserUI();
      } else {
        // logout UI
        authBlock.style.display = 'block';
        userBlock.style.display = 'none';
        authMsg.textContent = '';
      }
    });

    /* -------------------------
       COLETAR: l√≥gica 1h e salvar no Firestore
       ------------------------- */
    btnCollect.addEventListener('click', async () => {
      if (!currentUser) { alert('Fa√ßa login para coletar.'); return; }
      const agora = Date.now();
      const ultimo = userData.ultimo || 0;
      if (agora - ultimo < 3600000) {
        const faltam = 3600000 - (agora - ultimo);
        const m = Math.floor(faltam / 60000);
        const s = Math.floor((faltam % 60000) / 1000);
        alert(`Ainda n√£o passou 1 hora. Aguarde ${m}m ${s}s.`);
        return;
      }
      // incrementar local e no Firestore
      userData.bandeiras = (userData.bandeiras || 0) + 1;
      userData.ultimo = agora;
      // atualizar UI imediatamente
      refreshUserUI();
      // salva no Firestore
      try {
        const ref = doc(db, 'usuarios', currentUser.uid);
        await updateDoc(ref, { bandeiras: userData.bandeiras, ultimo: userData.ultimo });
        alert('Voc√™ coletou uma bandeira üáªüá¶!');
      } catch (err) {
        // se update falhar (por ex. doc n√£o existir), usa setDoc
        try {
          const ref = doc(db, 'usuarios', currentUser.uid);
          await setDoc(ref, { bandeiras: userData.bandeiras, ultimo: userData.ultimo }, { merge: true });
          alert('Voc√™ coletou uma bandeira üáªüá¶!');
        } catch (e2) {
          console.error('Erro salvando bandeira:', e2);
          alert('Erro ao salvar. Verifique o console e regras do Firestore.');
        }
      }
    });

    /* -------------------------
       Observa√ß√£o sobre regras Firestore
       ------------------------- */
    // Se voc√™ testar e der erro de permiss√£o (permission-denied), abra o console do Firebase:
    // Firestore ‚Üí Regras e, temporariamente para testes, use:
    // service cloud.firestore {
    //   match /databases/{database}/documents {
    //     match /{document=**} {
    //       allow read, write: if request.auth != null;
    //     }
    //   }
    // }
    // Isso permite somente usu√°rios autenticados a ler/gravar ‚Äî seguro para testes.
  </script>
</body>
                </html>
